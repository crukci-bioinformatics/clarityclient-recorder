<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.2 from src/site/apt/usage.apt at 2020-04-20

 | Rendered using Apache Maven Default Skin
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.9.2" />
    <title>CRUK-CI Genologics API Client Recorder &#x2013; </title>
    <link rel="stylesheet" href="./css/maven-base.css" />
    <link rel="stylesheet" href="./css/maven-theme.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
  </head>
  <body class="composite">
    <div id="banner">
<div id="bannerLeft">CRUK-CI Genologics API Recorder
</div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
      <div class="xleft">
        <span id="publishDate">Last Published: 2020-04-20</span>
          &#xA0;| <span id="projectVersion">Version: 2.27.0</span>
      </div>
      <div class="xright">      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
       <h5>User Guide</h5>
    <ul>
     <li class="none"><a href="installing.html" title="Installation">Installation</a></li>
     <li class="expanded"><a href="usageoverview.html" title="Usage">Usage</a>
      <ul>
       <li class="none"><a href="spring.html" title="Spring Configuration">Spring Configuration</a></li>
       <li class="none"><strong>Configuration in Code</strong></li>
      </ul></li>
    </ul>
       <h5>Project Documentation</h5>
    <ul>
     <li class="collapsed"><a href="project-info.html" title="Project Information">Project Information</a></li>
     <li class="collapsed"><a href="project-reports.html" title="Project Reports">Project Reports</a></li>
    </ul>
      <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
      </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
<section>
<h2><a name="Setting_up_the_Record_and_Playback_Wrappers"></a>Setting up the Record and Playback Wrappers</h2><section>
<h3><a name="Setting_the_Message_Directory"></a>Setting the Message Directory</h3>
<p>The record and playback wrappers around the Clarity client need no additional configuration beyond what is supplied in the Spring files. The one property that the user might want to change is the directory the server's messages are written to, or the pretend server reads from.</p>
<p>By default, both the recording and playback aspects write and read into a directory <code>serverexchanges</code> in the current working directory. This can be configured by setting the <i>messageDirectory</i> property in Spring configuration, or fetching the aspect in code and setting the property:</p>
<div class="source">
<pre>ApplicationContext appContext =
    new ClassPathXmlApplicationContext(
        &quot;/org/cruk/genologics/api/genologics-client-context.xml&quot;,
        &quot;/org/cruk/genologics/api/genologics-record-context.xml&quot;);

GenologicsAPIRecordingAspect aspect = ctx.getBean(GenologicsAPIRecordingAspect.class);
aspect.setMessageDirectory(new File(&quot;target/messages&quot;));</pre></div>
<p>Similarly, for playback:</p>
<div class="source">
<pre>ApplicationContext appContext =
    new ClassPathXmlApplicationContext(
        &quot;/org/cruk/genologics/api/genologics-client-context.xml&quot;,
        &quot;/org/cruk/genologics/api/genologics-playback-context.xml&quot;);

GenologicsAPIPlaybackAspect playbackAspect = ctx.getBean(GenologicsAPIPlaybackAspect.class);
playbackAspect.setMessageDirectory(new File(&quot;src/test/messages&quot;));</pre></div>
<p>This directory is not automatically created, so when recording make sure that it exists before communicating with the server.</p></section><section>
<h3><a name="Setting_the_Updates_Directory_during_Playback"></a>Setting the Updates Directory during Playback</h3>
<p>The playback wrapper returns results from previously recorded calls to the API's load, retrieve, load, find and list methods, finding the matching file in the messages directory, unmarshalling its XML and returning the object as the real API would. It quietly ignores create, delete and upload methods. Update calls can either by also quietly ignored, or they can be recorded in a separate directory. If one sets the <i>updatesDirectory</i>, any update calls will have the new versions of the entities written here with an incrementing index number.</p>
<p>For example, a sample with the id <i>S1234</i> has been read from the server and is recorded in the messages directory in a file <code>Sample-S1234.xml</code>. Each call to the API's <i>update</i> or <i>updateAll</i> methods for this sample will result in a file being added to the updates directory. The first will be <code>Sample-S1234.000.xml</code>, a second update will write <code>Sample-S1234.001.xml</code> and so forth. These updates can be checked as part of unit tests.</p>
<p>Update calls are ignored unless the <i>updatesDirectory</i> is set. Following from the example above, this would be done thus.</p>
<div class="source">
<pre>playbackAspect.setUpdatesDirectory(new File(&quot;target/updates&quot;));</pre></div></section></section>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
        Copyright &#169;      2013&#x2013;2020<a href="https://www.cruk.cam.ac.uk/">Cancer Research UK Cambridge Institute</a>.
.      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
